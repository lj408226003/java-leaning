## release 2.2(当前版本)

#### 发布时间

2019-05-29

#### 新增功能

1. 新增城市、分组领域，路由值和城市多对一、路由值和分组多对一。切换流量时支持按分组切或者按城市切。

   - i. 社餐的路由值即城市，团餐的城市是通过拉取阿里云的access日志，得到路由值和ip的关系，进而得到路由值和城市的关系；
   - ii. 社餐的路由值不允许修改城市，团餐可以通过【路由分布情况】页面路由列表修正所属城市；
   - iii. 分组是自定义的，在初始化数据时，原本在华东的路由值初始化为华东组，原本在华北的路由值初始化为华北组

2. 新增路由监控功能

   每次迁移流量都会自动把变化的路由值加入监控列表，持续监控到真实路由机房和预期机房一致为止。 在【路由分布情况】页面可以筛选每个机房“正确路由”列表、“错误路由”列表、“未请求路由”列表。

#### 优化功能

1. 合并按机房迁移流量和按路由迁移流量入口，新的流量迁移页面使用tab页组合
2. 流量迁移采用穿梭框的方式展现，不需要再去编辑路由规则，操作更加简便，也让用户更加清楚的知道流量迁移的预期结果（从源机房到目标机房）
3. 流量迁移支持树形展示和平铺展示，用户可以根据自己的使用习惯设置
4. 优化规则推送页面，用户在推送规则前能明确的知道影响范围。包括具体影响了哪些路由值、哪些域名的DNS解析结果
5. 支持按机房码实现双写保护功能 v2.2版本以前双写保护功能是借助redis实现的，每笔订单需要大概要额外写redis 3次（云小盒种植clientOrderId、orderId，网关种植outTradeNo），读redis 2次（支付回调，退款），这降低了支付的效率，增加了失败的风险。改用机房码后，云小盒、支付网关在生成orderId、outTradeNo时在固定位置拼上机房码，lua解析到机房码后将请求路由至目标机房。
6. 【路由分布情况】页面可以查看路由机房分布图和省市分布图
7. 【流量管理-域名-域名解析】页面可以修改域名IP和查看历史修改记录